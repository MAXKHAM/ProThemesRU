{% extends "base.html" %}

{% block title %}–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –±–ª–æ–∫–æ–≤ - ProThemesRU{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="text-center mb-4">üé® –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–æ–≤ ProThemesRU</h1>
            <p class="lead text-center">–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∞–π—Ç–æ–≤</p>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3 class="text-primary">{{ counts.total }}</h3>
                                <p>–í—Å–µ–≥–æ –±–ª–æ–∫–æ–≤</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3 class="text-success">{{ categories|length }}</h3>
                                <p>–ö–∞—Ç–µ–≥–æ—Ä–∏–π</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3 class="text-info">{{ counts.basic }}</h3>
                                <p>–ë–∞–∑–æ–≤—ã—Ö</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3 class="text-warning">{{ counts.interactive }}</h3>
                                <p>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–ª–æ–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
    {% for category in categories %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        {% if category == 'basic' %}üîß{% endif %}
                        {% if category == 'content' %}üìù{% endif %}
                        {% if category == 'interactive' %}üéÆ{% endif %}
                        {% if category == 'media' %}üì∑{% endif %}
                        {% if category == 'business' %}üíº{% endif %}
                        {% if category == 'social' %}üì±{% endif %}
                        {{ category.replace('_', ' ').title() }}
                        <span class="badge bg-secondary">{{ counts[category] }}</span>
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for block in blocks_by_category[category] %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title">{{ block.name }}</h6>
                                    <p class="card-text small text-muted">ID: {{ block.id }}</p>
                                    
                                    <!-- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä HTML -->
                                    <div class="mb-2">
                                        <small class="text-muted">HTML:</small>
                                        <div class="bg-light p-2 rounded" style="max-height: 100px; overflow: hidden;">
                                            <code class="small">{{ block.html[:100] }}{% if block.html|length > 100 %}...{% endif %}</code>
                                        </div>
                                    </div>
                                    
                                    <!-- –°–≤–æ–π—Å—Ç–≤–∞ -->
                                    {% if block.properties %}
                                    <div class="mb-2">
                                        <small class="text-muted">–°–≤–æ–π—Å—Ç–≤–∞:</small>
                                        <div>
                                            {% for prop in block.properties %}
                                            <span class="badge bg-outline-secondary me-1">{{ prop }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-sm btn-outline-primary" 
                                                onclick="previewBlock('{{ block.id }}')">
                                            üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" 
                                                onclick="addToConstructor('{{ block.id }}')">
                                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
    <div class="modal fade" id="blockPreviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –±–ª–æ–∫–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="blockPreviewContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button type="button" class="btn btn-primary" onclick="addCurrentBlockToConstructor()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let currentBlockId = null;

function previewBlock(blockId) {
    currentBlockId = blockId;
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∞
    const blocks = {{ blocks_by_category|tojson }};
    let blockData = null;
    
    for (const category in blocks) {
        const found = blocks[category].find(b => b.id === blockId);
        if (found) {
            blockData = found;
            break;
        }
    }
    
    if (blockData) {
        // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
        const previewContent = document.getElementById('blockPreviewContent');
        previewContent.innerHTML = `
            <div class="mb-3">
                <h6>${blockData.name}</h6>
                <p class="text-muted">ID: ${blockData.id}</p>
            </div>
            <div class="mb-3">
                <h6>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:</h6>
                <div class="border rounded p-3" style="background: white;">
                    ${blockData.html}
                </div>
            </div>
            <div class="mb-3">
                <h6>CSS —Å—Ç–∏–ª–∏:</h6>
                <pre class="bg-light p-2 rounded"><code>${blockData.css}</code></pre>
            </div>
        `;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = new bootstrap.Modal(document.getElementById('blockPreviewModal'));
        modal.show();
    }
}

function addToConstructor(blockId) {
    // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —á–µ—Ä–µ–∑ API
    fetch('/api/constructor/add-block', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            block_id: blockId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('–ë–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä!');
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–ª–æ–∫–∞');
    });
}

function addCurrentBlockToConstructor() {
    if (currentBlockId) {
        addToConstructor(currentBlockId);
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = bootstrap.Modal.getInstance(document.getElementById('blockPreviewModal'));
        modal.hide();
    }
}

// –î–æ–±–∞–≤–ª—è–µ–º CSS —Å—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const blocks = {{ blocks_by_category|tojson }};
    let cssStyles = '';
    
    for (const category in blocks) {
        for (const block of blocks[category]) {
            if (block.css) {
                cssStyles += block.css + '\n';
            }
        }
    }
    
    if (cssStyles) {
        const style = document.createElement('style');
        style.textContent = cssStyles;
        document.head.appendChild(style);
    }
});
</script>

<style>
.badge.bg-outline-secondary {
    background-color: transparent;
    border: 1px solid #6c757d;
    color: #6c757d;
}

.card {
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
</style>
{% endblock %} 
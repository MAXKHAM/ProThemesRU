{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\Desktop\\\\ProThemesRU1\\\\frontend\\\\src\\\\components\\\\Editor.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport Header from './Header';\nimport Sidebar from './Sidebar';\nimport Canvas from './Canvas';\nimport PropertiesPanel from './PropertiesPanel';\nimport AIColorPaletteGenerator from './AIColorPaletteGenerator';\nimport LayersPanel from './LayersPanel';\nimport { generateUniqueId } from '../utils/idGenerator';\nimport JSZip from 'jszip';\nimport { saveAs } from 'file-saver';\nimport logo from '../assets/logo.png';\nimport { generateHtmlCss } from '../utils/exportUtils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MAX_HISTORY_SIZE = 50;\nfunction Editor() {\n  _s();\n  const [elements, setElements] = useState([]);\n  const [selectedElementIds, setSelectedElementIds] = useState([]);\n  const canvasRef = useRef(null);\n  const [history, setHistory] = useState([[]]);\n  const [historyIndex, setHistoryIndex] = useState(0);\n  useEffect(() => {\n    if (history[historyIndex] === elements) {\n      return;\n    }\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(elements);\n    if (newHistory.length > MAX_HISTORY_SIZE) {\n      newHistory.shift();\n    }\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  }, [elements, history, historyIndex]);\n  useEffect(() => {\n    try {\n      const savedElements = localStorage.getItem('canvasElements');\n      if (savedElements) {\n        let loadedElements = JSON.parse(savedElements);\n        // Ensure loaded elements have parentId, customClasses, customStyles, and new flex properties\n        loadedElements = loadedElements.map(el => ({\n          ...el,\n          parentId: el.parentId === undefined ? null : el.parentId,\n          props: {\n            ...(el.props || {}),\n            customClasses: el.props && el.props.customClasses === undefined ? [] : el.props.customClasses,\n            customStyles: el.props && el.props.customStyles === undefined ? {} : el.props.customStyles,\n            // NEW: Default for flex properties for groups\n            displayMode: el.type === 'group' && el.props && el.props.displayMode === undefined ? 'absolute' : el.props ? el.props.displayMode : undefined,\n            flexDirection: el.type === 'group' && el.props && el.props.flexDirection === undefined ? 'row' : el.props ? el.props.flexDirection : undefined,\n            justifyContent: el.type === 'group' && el.props && el.props.justifyContent === undefined ? 'flex-start' : el.props ? el.props.justifyContent : undefined,\n            alignItems: el.type === 'group' && el.props && el.props.alignItems === undefined ? 'stretch' : el.props ? el.props.alignItems : undefined,\n            gap: el.type === 'group' && el.props && el.props.gap === undefined ? '0px' : el.props ? el.props.gap : undefined\n          }\n        }));\n        setElements(loadedElements);\n        setHistory([loadedElements]);\n        setHistoryIndex(0);\n      }\n    } catch (e) {\n      console.error(\"Failed to load elements from localStorage\", e);\n    }\n  }, []);\n  const selectedElement = selectedElementIds.length > 0 ? elements.find(el => el.id === selectedElementIds[0]) : null;\n  const addElement = useCallback((type, x, y) => {\n    const newElement = {\n      id: generateUniqueId(),\n      type,\n      x,\n      y,\n      width: 150,\n      height: 50,\n      parentId: null,\n      props: {\n        name: `${type.charAt(0).toUpperCase() + type.slice(1)} ${elements.filter(el => el.type !== 'group').length + 1}`,\n        customClasses: [],\n        customStyles: {}\n      }\n    };\n    switch (type) {\n      case 'text':\n        newElement.props = {\n          ...newElement.props,\n          content: 'Новый текст',\n          fontSize: '16px',\n          color: '#000000'\n        };\n        newElement.width = 200;\n        newElement.height = 40;\n        break;\n      case 'image':\n        newElement.props = {\n          ...newElement.props,\n          src: 'https://via.placeholder.com/150',\n          alt: 'Изображение'\n        };\n        newElement.width = 150;\n        newElement.height = 150;\n        break;\n      case 'button':\n        newElement.props = {\n          ...newElement.props,\n          label: 'Кнопка',\n          bgColor: '#007bff',\n          textColor: '#ffffff'\n        };\n        newElement.width = 120;\n        newElement.height = 40;\n        break;\n      case 'shape':\n        newElement.props = {\n          ...newElement.props,\n          bgColor: '#ffc107',\n          borderRadius: '0'\n        };\n        newElement.width = 100;\n        newElement.height = 100;\n        break;\n      case 'group':\n        // NEW: Default props for a new group\n        newElement.props = {\n          ...newElement.props,\n          name: `Группа ${elements.filter(el => el.type === 'group').length + 1}`,\n          displayMode: 'absolute',\n          // Default to absolute positioning for groups\n          flexDirection: 'row',\n          justifyContent: 'flex-start',\n          alignItems: 'stretch',\n          gap: '0px'\n        };\n        newElement.width = 250;\n        newElement.height = 150;\n        break;\n      default:\n        break;\n    }\n    setElements(prevElements => [...prevElements, newElement]);\n    setSelectedElementIds([newElement.id]);\n  }, [elements.length]);\n  const updateElement = useCallback((id, updates) => {\n    setElements(prevElements => prevElements.map(el => el.id === id ? {\n      ...el,\n      ...updates\n    } : el));\n  }, []);\n  const updateMultipleElements = useCallback((ids, updatesMap) => {\n    setElements(prevElements => prevElements.map(el => {\n      if (ids.includes(el.id)) {\n        const updates = updatesMap[el.id];\n        return {\n          ...el,\n          ...updates\n        };\n      }\n      return el;\n    }));\n  }, []);\n  const updateElementProps = useCallback((id, newProps) => {\n    setElements(prevElements => prevElements.map(el => el.id === id ? {\n      ...el,\n      props: {\n        ...el.props,\n        ...newProps\n      }\n    } : el));\n  }, []);\n  const deleteElement = useCallback(id => {\n    setElements(prevElements => prevElements.filter(el => el.id !== id));\n    setSelectedElementIds(prevIds => prevIds.filter(prevId => prevId !== id));\n  }, []);\n  const deleteSelectedElements = useCallback(() => {\n    if (selectedElementIds.length > 0 && window.confirm(`Вы уверены, что хотите удалить выбранные элементы (${selectedElementIds.length})?`)) {\n      setElements(prevElements => prevElements.filter(el => !selectedElementIds.includes(el.id)));\n      setSelectedElementIds([]);\n    }\n  }, [selectedElementIds]);\n  const saveCanvas = useCallback(() => {\n    try {\n      localStorage.setItem('canvasElements', JSON.stringify(elements));\n      alert('Проект сохранен!');\n    } catch (e) {\n      console.error(\"Failed to save elements to localStorage\", e);\n      alert('Ошибка при сохранении проекта!');\n    }\n  }, [elements]);\n  const clearCanvas = useCallback(() => {\n    if (window.confirm('Вы уверены, что хотите очистить канвас? Все несохраненные изменения будут потеряны!')) {\n      setElements([]);\n      setSelectedElementIds([]);\n      localStorage.removeItem('canvasElements');\n      alert('Канвас очищен!');\n    }\n  }, []);\n  const exportToHtmlCss = useCallback(() => {\n    const {\n      htmlContent,\n      cssContent\n    } = generateHtmlCss(elements);\n    const zip = new JSZip();\n    zip.file(\"index.html\", htmlContent);\n    zip.file(\"style.css\", cssContent);\n    zip.generateAsync({\n      type: \"blob\"\n    }).then(function (content) {\n      saveAs(content, \"my_design.zip\");\n      alert('Дизайн экспортирован в ZIP-архив!');\n    }).catch(e => {\n      console.error(\"Error exporting to ZIP:\", e);\n      alert('Ошибка при экспорте дизайна!');\n    });\n  }, [elements]);\n  const undo = useCallback(() => {\n    if (historyIndex > 0) {\n      const newIndex = historyIndex - 1;\n      setHistoryIndex(newIndex);\n      setElements(history[newIndex]);\n      setSelectedElementIds([]);\n    }\n  }, [history, historyIndex]);\n  const redo = useCallback(() => {\n    if (historyIndex < history.length - 1) {\n      const newIndex = historyIndex + 1;\n      setHistoryIndex(newIndex);\n      setElements(history[newIndex]);\n      setSelectedElementIds([]);\n    }\n  }, [history, historyIndex]);\n  const onMoveLayer = useCallback((fromIndex, toIndex) => {\n    setElements(prevElements => {\n      const newElements = [...prevElements];\n      const [movedElement] = newElements.splice(fromIndex, 1);\n      newElements.splice(toIndex, 0, movedElement);\n      return newElements;\n    });\n  }, []);\n\n  // --- Горячие клавиши ---\n  const canUndo = historyIndex > 0;\n  const canRedo = historyIndex < history.length - 1;\n  const handleKeyDown = useCallback(e => {\n    // Не срабатывает, если фокус в input/textarea\n    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {\n      return;\n    }\n    const isCtrlOrCmd = e.metaKey || e.ctrlKey;\n    // Undo: Ctrl+Z / Cmd+Z\n    if (isCtrlOrCmd && e.key === 'z' && !e.shiftKey) {\n      e.preventDefault();\n      if (canUndo) undo();\n    }\n    // Redo: Ctrl+Shift+Z / Cmd+Shift+Z\n    else if (isCtrlOrCmd && e.key.toLowerCase() === 'z' && e.shiftKey) {\n      e.preventDefault();\n      if (canRedo) redo();\n    }\n    // Redo alternative: Ctrl+Y / Cmd+Y\n    else if (isCtrlOrCmd && e.key.toLowerCase() === 'y') {\n      e.preventDefault();\n      if (canRedo) redo();\n    }\n    // Delete/Backspace\n    else if (e.key === 'Delete' || e.key === 'Backspace') {\n      if (selectedElementIds.length > 0) {\n        e.preventDefault();\n        deleteSelectedElements();\n      }\n    }\n    // Save: Ctrl+S / Cmd+S\n    else if (isCtrlOrCmd && e.key.toLowerCase() === 's') {\n      e.preventDefault();\n      saveCanvas();\n    }\n  }, [canUndo, undo, canRedo, redo, selectedElementIds, deleteSelectedElements, saveCanvas]);\n  useEffect(() => {\n    document.addEventListener('keydown', handleKeyDown);\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [handleKeyDown]);\n\n  // НОВАЯ ФУНКЦИЯ: Выравнивание элементов\n  const alignElements = useCallback(alignment => {\n    if (selectedElementIds.length < 2) return; // Для выравнивания нужно хотя бы 2 элемента\n\n    const selected = elements.filter(el => selectedElementIds.includes(el.id));\n\n    // Находим ограничивающую рамку для всех выбранных элементов\n    let minX = Infinity,\n      minY = Infinity;\n    let maxX = -Infinity,\n      maxY = -Infinity;\n    selected.forEach(el => {\n      minX = Math.min(minX, el.x);\n      minY = Math.min(minY, el.y);\n      maxX = Math.max(maxX, el.x + el.width);\n      maxY = Math.max(maxY, el.y + el.height);\n    });\n    const boundingBoxWidth = maxX - minX;\n    const boundingBoxHeight = maxY - minY;\n    const boundingBoxCenterX = minX + boundingBoxWidth / 2;\n    const boundingBoxCenterY = minY + boundingBoxHeight / 2;\n    setElements(prevElements => {\n      return prevElements.map(el => {\n        if (selectedElementIds.includes(el.id)) {\n          let newX = el.x;\n          let newY = el.y;\n          switch (alignment) {\n            case 'left':\n              newX = minX;\n              break;\n            case 'center-h':\n              newX = boundingBoxCenterX - el.width / 2;\n              break;\n            case 'right':\n              newX = maxX - el.width;\n              break;\n            case 'top':\n              newY = minY;\n              break;\n            case 'center-v':\n              newY = boundingBoxCenterY - el.height / 2;\n              break;\n            case 'bottom':\n              newY = maxY - el.height;\n              break;\n            default:\n              break;\n          }\n          return {\n            ...el,\n            x: newX,\n            y: newY\n          };\n        }\n        return el;\n      });\n    });\n  }, [elements, selectedElementIds]);\n\n  // НОВАЯ ФУНКЦИЯ: Распределение элементов\n  const distributeElements = useCallback(axis => {\n    if (selectedElementIds.length < 3) return; // Для распределения нужно хотя бы 3 элемента\n\n    const selected = elements.filter(el => selectedElementIds.includes(el.id)).sort((a, b) => axis === 'horizontal' ? a.x - b.x : a.y - b.y); // Сортируем по оси\n\n    if (selected.length < 2) return; // На всякий случай, если после фильтрации осталось мало элементов\n\n    // Находим крайние точки для распределения\n    const firstElement = selected[0];\n    const lastElement = selected[selected.length - 1];\n    setElements(prevElements => {\n      const newElements = [...prevElements];\n      const updatesMap = {};\n      if (axis === 'horizontal') {\n        const startX = firstElement.x;\n        const endX = lastElement.x + lastElement.width;\n        const totalWidth = endX - startX;\n        let totalElementsWidth = 0;\n        selected.forEach(el => totalElementsWidth += el.width);\n        const availableSpace = totalWidth - totalElementsWidth;\n        const spacing = availableSpace / (selected.length - 1);\n        let currentX = startX;\n        selected.forEach((el, index) => {\n          if (index === 0) {\n            updatesMap[el.id] = {\n              x: currentX\n            };\n          } else {\n            currentX += selected[index - 1].width + spacing;\n            updatesMap[el.id] = {\n              x: currentX\n            };\n          }\n        });\n      } else {\n        // vertical\n        const startY = firstElement.y;\n        const endY = lastElement.y + lastElement.height;\n        const totalHeight = endY - startY;\n        let totalElementsHeight = 0;\n        selected.forEach(el => totalElementsHeight += el.height);\n        const availableSpace = totalHeight - totalElementsHeight;\n        const spacing = availableSpace / (selected.length - 1);\n        let currentY = startY;\n        selected.forEach((el, index) => {\n          if (index === 0) {\n            updatesMap[el.id] = {\n              y: currentY\n            };\n          } else {\n            currentY += selected[index - 1].height + spacing;\n            updatesMap[el.id] = {\n              y: currentY\n            };\n          }\n        });\n      }\n\n      // Применяем обновления\n      return prevElements.map(el => {\n        if (updatesMap[el.id]) {\n          return {\n            ...el,\n            ...updatesMap[el.id]\n          };\n        }\n        return el;\n      });\n    });\n  }, [elements, selectedElementIds]);\n  const loadMySite = useCallback(async () => {\n    const token = localStorage.getItem('access_token');\n    if (!token) {\n      alert('Вы не авторизованы. Пожалуйста, войдите как администратор.');\n      return;\n    }\n    if (!window.confirm('Вы уверены, что хотите загрузить сайт с сервера? Все несохраненные изменения будут потеряны!')) {\n      return;\n    }\n    try {\n      const response = await fetch(`${API_BASE_URL}/admin/load_my_site_data`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.msg || 'Ошибка при загрузке сайта с сервера');\n      }\n      let loadedElements = await response.json();\n      // Ensure loaded elements have parentId, customClasses, customStyles, and new flex properties\n      loadedElements = loadedElements.map(el => ({\n        ...el,\n        parentId: el.parentId === undefined ? null : el.parentId,\n        props: {\n          ...(el.props || {}),\n          customClasses: el.props && el.props.customClasses === undefined ? [] : el.props.customClasses,\n          customStyles: el.props && el.props.customStyles === undefined ? {} : el.props.customStyles,\n          displayMode: el.type === 'group' && el.props && el.props.displayMode === undefined ? 'absolute' : el.props ? el.props.displayMode : undefined,\n          flexDirection: el.type === 'group' && el.props && el.props.flexDirection === undefined ? 'row' : el.props ? el.props.flexDirection : undefined,\n          justifyContent: el.type === 'group' && el.props && el.props.justifyContent === undefined ? 'flex-start' : el.props ? el.props.justifyContent : undefined,\n          alignItems: el.type === 'group' && el.props && el.props.alignItems === undefined ? 'stretch' : el.props ? el.props.alignItems : undefined,\n          gap: el.type === 'group' && el.props && el.props.gap === undefined ? '0px' : el.props ? el.props.gap : undefined\n        }\n      }));\n      setElements(loadedElements);\n      setHistory([loadedElements]);\n      setHistoryIndex(0);\n      setSelectedElementIds([]);\n      alert('Сайт успешно загружен с сервера!');\n    } catch (error) {\n      console.error(\"Error loading site:\", error);\n      alert(`Ошибка загрузки сайта: ${error.message}`);\n    }\n  }, []);\n  const groupSelectedElements = useCallback(() => {\n    if (selectedElementIds.length < 2) return;\n    const elementsToGroup = elements.filter(el => selectedElementIds.includes(el.id) && el.type !== 'group');\n    if (elementsToGroup.length < 2) {\n      alert('Для группировки выберите хотя бы два негруппированных элемента.');\n      return;\n    }\n    const hasMixedParents = new Set(elementsToGroup.map(el => el.parentId)).size > 1;\n    const hasParentGroupSelected = elementsToGroup.some(el => el.parentId && selectedElementIds.includes(el.parentId));\n    if (hasMixedParents || hasParentGroupSelected) {\n      alert('Нельзя группировать элементы из разных групп или элементы вместе с их родительскими группами. Сначала разгруппируйте их.');\n      return;\n    }\n    let minX = Infinity,\n      minY = Infinity;\n    let maxX = -Infinity,\n      maxY = -Infinity;\n    elementsToGroup.forEach(el => {\n      const absPos = getAbsolutePosition(el);\n      minX = Math.min(minX, absPos.x);\n      minY = Math.min(minY, absPos.y);\n      maxX = Math.max(maxX, absPos.x + el.width);\n      maxY = Math.max(maxY, absPos.y + el.height);\n    });\n    const newGroupId = generateUniqueId();\n    const newGroup = {\n      id: newGroupId,\n      type: 'group',\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY,\n      parentId: null,\n      props: {\n        name: `Группа ${elements.filter(el => el.type === 'group').length + 1}`,\n        customClasses: [],\n        customStyles: {},\n        displayMode: 'absolute',\n        flexDirection: 'row',\n        justifyContent: 'flex-start',\n        alignItems: 'stretch',\n        gap: '0px'\n      }\n    };\n    setElements(prevElements => {\n      return [...prevElements.filter(el => !selectedElementIds.includes(el.id)), newGroup, ...elementsToGroup.map(el => {\n        const absPos = getAbsolutePosition(el);\n        return {\n          ...el,\n          parentId: newGroupId,\n          x: absPos.x - newGroup.x,\n          y: absPos.y - newGroup.y\n        };\n      })];\n    });\n    setSelectedElementIds([newGroupId]);\n  }, [elements, selectedElementIds, getAbsolutePosition]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 508,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor\",\n      children: [/*#__PURE__*/_jsxDEV(Sidebar, {\n        addElement: addElement\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Canvas, {\n        ref: canvasRef,\n        elements: elements,\n        updateElement: updateElement,\n        updateMultipleElements: updateMultipleElements,\n        selectedElementIds: selectedElementIds,\n        setSelectedElementIds: setSelectedElementIds,\n        deleteElement: deleteElement\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 511,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(PropertiesPanel, {\n        selectedElement: selectedElement,\n        selectedElementIds: selectedElementIds,\n        updateElementProps: updateElementProps,\n        updateElement: updateElement,\n        saveCanvas: saveCanvas,\n        clearCanvas: clearCanvas,\n        exportToHtmlCss: exportToHtmlCss,\n        undo: undo,\n        redo: redo,\n        canUndo: canUndo,\n        canRedo: canRedo,\n        deleteSelectedElements: deleteSelectedElements,\n        alignElements: alignElements,\n        distributeElements: distributeElements\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 520,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(AIColorPaletteGenerator, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 536,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(LayersPanel, {\n        elements: elements,\n        selectedElementIds: selectedElementIds,\n        setSelectedElementIds: setSelectedElementIds,\n        updateElement: updateElement,\n        updateElementProps: updateElementProps,\n        onMoveLayer: onMoveLayer\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 537,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 509,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 507,\n    columnNumber: 5\n  }, this);\n}\n_s(Editor, \"OaT4/tHbETPgmWrtntxhOLP2Ljc=\");\n_c = Editor;\nexport default Editor;\nvar _c;\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","Header","Sidebar","Canvas","PropertiesPanel","AIColorPaletteGenerator","LayersPanel","generateUniqueId","JSZip","saveAs","logo","generateHtmlCss","jsxDEV","_jsxDEV","MAX_HISTORY_SIZE","Editor","_s","elements","setElements","selectedElementIds","setSelectedElementIds","canvasRef","history","setHistory","historyIndex","setHistoryIndex","newHistory","slice","push","length","shift","savedElements","localStorage","getItem","loadedElements","JSON","parse","map","el","parentId","undefined","props","customClasses","customStyles","displayMode","type","flexDirection","justifyContent","alignItems","gap","e","console","error","selectedElement","find","id","addElement","x","y","newElement","width","height","name","charAt","toUpperCase","filter","content","fontSize","color","src","alt","label","bgColor","textColor","borderRadius","prevElements","updateElement","updates","updateMultipleElements","ids","updatesMap","includes","updateElementProps","newProps","deleteElement","prevIds","prevId","deleteSelectedElements","window","confirm","saveCanvas","setItem","stringify","alert","clearCanvas","removeItem","exportToHtmlCss","htmlContent","cssContent","zip","file","generateAsync","then","catch","undo","newIndex","redo","onMoveLayer","fromIndex","toIndex","newElements","movedElement","splice","canUndo","canRedo","handleKeyDown","target","tagName","isCtrlOrCmd","metaKey","ctrlKey","key","shiftKey","preventDefault","toLowerCase","document","addEventListener","removeEventListener","alignElements","alignment","selected","minX","Infinity","minY","maxX","maxY","forEach","Math","min","max","boundingBoxWidth","boundingBoxHeight","boundingBoxCenterX","boundingBoxCenterY","newX","newY","distributeElements","axis","sort","a","b","firstElement","lastElement","startX","endX","totalWidth","totalElementsWidth","availableSpace","spacing","currentX","index","startY","endY","totalHeight","totalElementsHeight","currentY","loadMySite","token","response","fetch","API_BASE_URL","headers","ok","errorData","json","Error","msg","message","groupSelectedElements","elementsToGroup","hasMixedParents","Set","size","hasParentGroupSelected","some","absPos","getAbsolutePosition","newGroupId","newGroup","children","fileName","_jsxFileName","lineNumber","columnNumber","className","ref","_c","$RefreshReg$"],"sources":["C:/Users/user/Desktop/ProThemesRU1/frontend/src/components/Editor.js"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport Header from './Header';\r\nimport Sidebar from './Sidebar';\r\nimport Canvas from './Canvas';\r\nimport PropertiesPanel from './PropertiesPanel';\r\nimport AIColorPaletteGenerator from './AIColorPaletteGenerator';\r\nimport LayersPanel from './LayersPanel';\r\nimport { generateUniqueId } from '../utils/idGenerator';\r\nimport JSZip from 'jszip';\r\nimport { saveAs } from 'file-saver';\r\nimport logo from '../assets/logo.png';\r\nimport { generateHtmlCss } from '../utils/exportUtils';\r\n\r\nconst MAX_HISTORY_SIZE = 50;\r\n\r\nfunction Editor() {\r\n  const [elements, setElements] = useState([]);\r\n  const [selectedElementIds, setSelectedElementIds] = useState([]);\r\n  const canvasRef = useRef(null);\r\n\r\n  const [history, setHistory] = useState([[]]);\r\n  const [historyIndex, setHistoryIndex] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (history[historyIndex] === elements) {\r\n        return;\r\n    }\r\n\r\n    const newHistory = history.slice(0, historyIndex + 1);\r\n    newHistory.push(elements);\r\n\r\n    if (newHistory.length > MAX_HISTORY_SIZE) {\r\n        newHistory.shift();\r\n    }\r\n\r\n    setHistory(newHistory);\r\n    setHistoryIndex(newHistory.length - 1);\r\n  }, [elements, history, historyIndex]);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const savedElements = localStorage.getItem('canvasElements');\r\n      if (savedElements) {\r\n        let loadedElements = JSON.parse(savedElements);\r\n        // Ensure loaded elements have parentId, customClasses, customStyles, and new flex properties\r\n        loadedElements = loadedElements.map(el => ({\r\n            ...el,\r\n            parentId: el.parentId === undefined ? null : el.parentId,\r\n            props: {\r\n                ...(el.props || {}),\r\n                customClasses: el.props && el.props.customClasses === undefined ? [] : el.props.customClasses,\r\n                customStyles: el.props && el.props.customStyles === undefined ? {} : el.props.customStyles,\r\n                // NEW: Default for flex properties for groups\r\n                displayMode: el.type === 'group' && el.props && el.props.displayMode === undefined ? 'absolute' : (el.props ? el.props.displayMode : undefined),\r\n                flexDirection: el.type === 'group' && el.props && el.props.flexDirection === undefined ? 'row' : (el.props ? el.props.flexDirection : undefined),\r\n                justifyContent: el.type === 'group' && el.props && el.props.justifyContent === undefined ? 'flex-start' : (el.props ? el.props.justifyContent : undefined),\r\n                alignItems: el.type === 'group' && el.props && el.props.alignItems === undefined ? 'stretch' : (el.props ? el.props.alignItems : undefined),\r\n                gap: el.type === 'group' && el.props && el.props.gap === undefined ? '0px' : (el.props ? el.props.gap : undefined),\r\n            }\r\n        }));\r\n        setElements(loadedElements);\r\n        setHistory([loadedElements]);\r\n        setHistoryIndex(0);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Failed to load elements from localStorage\", e);\r\n    }\r\n  }, []);\r\n\r\n  const selectedElement = selectedElementIds.length > 0\r\n    ? elements.find(el => el.id === selectedElementIds[0])\r\n    : null;\r\n\r\n  const addElement = useCallback((type, x, y) => {\r\n    const newElement = {\r\n      id: generateUniqueId(),\r\n      type,\r\n      x,\r\n      y,\r\n      width: 150,\r\n      height: 50,\r\n      parentId: null,\r\n      props: {\r\n        name: `${type.charAt(0).toUpperCase() + type.slice(1)} ${elements.filter(el => el.type !== 'group').length + 1}`,\r\n        customClasses: [],\r\n        customStyles: {},\r\n      },\r\n    };\r\n    switch (type) {\r\n      case 'text':\r\n        newElement.props = { ...newElement.props, content: 'Новый текст', fontSize: '16px', color: '#000000' };\r\n        newElement.width = 200;\r\n        newElement.height = 40;\r\n        break;\r\n      case 'image':\r\n        newElement.props = { ...newElement.props, src: 'https://via.placeholder.com/150', alt: 'Изображение' };\r\n        newElement.width = 150;\r\n        newElement.height = 150;\r\n        break;\r\n      case 'button':\r\n        newElement.props = { ...newElement.props, label: 'Кнопка', bgColor: '#007bff', textColor: '#ffffff' };\r\n        newElement.width = 120;\r\n        newElement.height = 40;\r\n        break;\r\n      case 'shape':\r\n        newElement.props = { ...newElement.props, bgColor: '#ffc107', borderRadius: '0' };\r\n        newElement.width = 100;\r\n        newElement.height = 100;\r\n        break;\r\n      case 'group': // NEW: Default props for a new group\r\n        newElement.props = {\r\n            ...newElement.props,\r\n            name: `Группа ${elements.filter(el => el.type === 'group').length + 1}`,\r\n            displayMode: 'absolute', // Default to absolute positioning for groups\r\n            flexDirection: 'row',\r\n            justifyContent: 'flex-start',\r\n            alignItems: 'stretch',\r\n            gap: '0px',\r\n        };\r\n        newElement.width = 250;\r\n        newElement.height = 150;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    setElements(prevElements => [...prevElements, newElement]);\r\n    setSelectedElementIds([newElement.id]);\r\n  }, [elements.length]);\r\n\r\n  const updateElement = useCallback((id, updates) => {\r\n    setElements(prevElements =>\r\n      prevElements.map(el => (el.id === id ? { ...el, ...updates } : el))\r\n    );\r\n  }, []);\r\n\r\n  const updateMultipleElements = useCallback((ids, updatesMap) => {\r\n    setElements(prevElements =>\r\n      prevElements.map(el => {\r\n        if (ids.includes(el.id)) {\r\n          const updates = updatesMap[el.id];\r\n          return { ...el, ...updates };\r\n        }\r\n        return el;\r\n      })\r\n    );\r\n  }, []);\r\n\r\n  const updateElementProps = useCallback((id, newProps) => {\r\n    setElements(prevElements =>\r\n      prevElements.map(el => (el.id === id ? { ...el, props: { ...el.props, ...newProps } } : el))\r\n    );\r\n  }, []);\r\n\r\n  const deleteElement = useCallback((id) => {\r\n    setElements(prevElements => prevElements.filter(el => el.id !== id));\r\n    setSelectedElementIds(prevIds => prevIds.filter(prevId => prevId !== id));\r\n  }, []);\r\n\r\n  const deleteSelectedElements = useCallback(() => {\r\n    if (selectedElementIds.length > 0 && window.confirm(`Вы уверены, что хотите удалить выбранные элементы (${selectedElementIds.length})?`)) {\r\n      setElements(prevElements =>\r\n        prevElements.filter(el => !selectedElementIds.includes(el.id))\r\n      );\r\n      setSelectedElementIds([]);\r\n    }\r\n  }, [selectedElementIds]);\r\n\r\n  const saveCanvas = useCallback(() => {\r\n    try {\r\n      localStorage.setItem('canvasElements', JSON.stringify(elements));\r\n      alert('Проект сохранен!');\r\n    } catch (e) {\r\n      console.error(\"Failed to save elements to localStorage\", e);\r\n      alert('Ошибка при сохранении проекта!');\r\n    }\r\n  }, [elements]);\r\n\r\n  const clearCanvas = useCallback(() => {\r\n    if (window.confirm('Вы уверены, что хотите очистить канвас? Все несохраненные изменения будут потеряны!')) {\r\n      setElements([]);\r\n      setSelectedElementIds([]);\r\n      localStorage.removeItem('canvasElements');\r\n      alert('Канвас очищен!');\r\n    }\r\n  }, []);\r\n\r\n  const exportToHtmlCss = useCallback(() => {\r\n    const { htmlContent, cssContent } = generateHtmlCss(elements);\r\n    const zip = new JSZip();\r\n    zip.file(\"index.html\", htmlContent);\r\n    zip.file(\"style.css\", cssContent);\r\n    zip.generateAsync({ type: \"blob\" })\r\n      .then(function (content) {\r\n        saveAs(content, \"my_design.zip\");\r\n        alert('Дизайн экспортирован в ZIP-архив!');\r\n      })\r\n      .catch(e => {\r\n        console.error(\"Error exporting to ZIP:\", e);\r\n        alert('Ошибка при экспорте дизайна!');\r\n      });\r\n  }, [elements]);\r\n\r\n  const undo = useCallback(() => {\r\n    if (historyIndex > 0) {\r\n      const newIndex = historyIndex - 1;\r\n      setHistoryIndex(newIndex);\r\n      setElements(history[newIndex]);\r\n      setSelectedElementIds([]);\r\n    }\r\n  }, [history, historyIndex]);\r\n\r\n  const redo = useCallback(() => {\r\n    if (historyIndex < history.length - 1) {\r\n      const newIndex = historyIndex + 1;\r\n      setHistoryIndex(newIndex);\r\n      setElements(history[newIndex]);\r\n      setSelectedElementIds([]);\r\n    }\r\n  }, [history, historyIndex]);\r\n\r\n  const onMoveLayer = useCallback((fromIndex, toIndex) => {\r\n    setElements(prevElements => {\r\n      const newElements = [...prevElements];\r\n      const [movedElement] = newElements.splice(fromIndex, 1);\r\n      newElements.splice(toIndex, 0, movedElement);\r\n      return newElements;\r\n    });\r\n  }, []);\r\n\r\n  // --- Горячие клавиши ---\r\n  const canUndo = historyIndex > 0;\r\n  const canRedo = historyIndex < history.length - 1;\r\n\r\n  const handleKeyDown = useCallback((e) => {\r\n    // Не срабатывает, если фокус в input/textarea\r\n    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {\r\n      return;\r\n    }\r\n    const isCtrlOrCmd = e.metaKey || e.ctrlKey;\r\n    // Undo: Ctrl+Z / Cmd+Z\r\n    if (isCtrlOrCmd && e.key === 'z' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      if (canUndo) undo();\r\n    }\r\n    // Redo: Ctrl+Shift+Z / Cmd+Shift+Z\r\n    else if (isCtrlOrCmd && e.key.toLowerCase() === 'z' && e.shiftKey) {\r\n      e.preventDefault();\r\n      if (canRedo) redo();\r\n    }\r\n    // Redo alternative: Ctrl+Y / Cmd+Y\r\n    else if (isCtrlOrCmd && e.key.toLowerCase() === 'y') {\r\n      e.preventDefault();\r\n      if (canRedo) redo();\r\n    }\r\n    // Delete/Backspace\r\n    else if (e.key === 'Delete' || e.key === 'Backspace') {\r\n      if (selectedElementIds.length > 0) {\r\n        e.preventDefault();\r\n        deleteSelectedElements();\r\n      }\r\n    }\r\n    // Save: Ctrl+S / Cmd+S\r\n    else if (isCtrlOrCmd && e.key.toLowerCase() === 's') {\r\n      e.preventDefault();\r\n      saveCanvas();\r\n    }\r\n  }, [canUndo, undo, canRedo, redo, selectedElementIds, deleteSelectedElements, saveCanvas]);\r\n\r\n  useEffect(() => {\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [handleKeyDown]);\r\n\r\n  // НОВАЯ ФУНКЦИЯ: Выравнивание элементов\r\n  const alignElements = useCallback((alignment) => {\r\n    if (selectedElementIds.length < 2) return; // Для выравнивания нужно хотя бы 2 элемента\r\n\r\n    const selected = elements.filter(el => selectedElementIds.includes(el.id));\r\n\r\n    // Находим ограничивающую рамку для всех выбранных элементов\r\n    let minX = Infinity, minY = Infinity;\r\n    let maxX = -Infinity, maxY = -Infinity;\r\n\r\n    selected.forEach(el => {\r\n      minX = Math.min(minX, el.x);\r\n      minY = Math.min(minY, el.y);\r\n      maxX = Math.max(maxX, el.x + el.width);\r\n      maxY = Math.max(maxY, el.y + el.height);\r\n    });\r\n\r\n    const boundingBoxWidth = maxX - minX;\r\n    const boundingBoxHeight = maxY - minY;\r\n    const boundingBoxCenterX = minX + boundingBoxWidth / 2;\r\n    const boundingBoxCenterY = minY + boundingBoxHeight / 2;\r\n\r\n    setElements(prevElements => {\r\n      return prevElements.map(el => {\r\n        if (selectedElementIds.includes(el.id)) {\r\n          let newX = el.x;\r\n          let newY = el.y;\r\n\r\n          switch (alignment) {\r\n            case 'left':\r\n              newX = minX;\r\n              break;\r\n            case 'center-h':\r\n              newX = boundingBoxCenterX - el.width / 2;\r\n              break;\r\n            case 'right':\r\n              newX = maxX - el.width;\r\n              break;\r\n            case 'top':\r\n              newY = minY;\r\n              break;\r\n            case 'center-v':\r\n              newY = boundingBoxCenterY - el.height / 2;\r\n              break;\r\n            case 'bottom':\r\n              newY = maxY - el.height;\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n          return { ...el, x: newX, y: newY };\r\n        }\r\n        return el;\r\n      });\r\n    });\r\n  }, [elements, selectedElementIds]);\r\n\r\n  // НОВАЯ ФУНКЦИЯ: Распределение элементов\r\n  const distributeElements = useCallback((axis) => {\r\n    if (selectedElementIds.length < 3) return; // Для распределения нужно хотя бы 3 элемента\r\n\r\n    const selected = elements\r\n      .filter(el => selectedElementIds.includes(el.id))\r\n      .sort((a, b) => (axis === 'horizontal' ? a.x - b.x : a.y - b.y)); // Сортируем по оси\r\n\r\n    if (selected.length < 2) return; // На всякий случай, если после фильтрации осталось мало элементов\r\n\r\n    // Находим крайние точки для распределения\r\n    const firstElement = selected[0];\r\n    const lastElement = selected[selected.length - 1];\r\n\r\n    setElements(prevElements => {\r\n      const newElements = [...prevElements];\r\n      const updatesMap = {};\r\n\r\n      if (axis === 'horizontal') {\r\n        const startX = firstElement.x;\r\n        const endX = lastElement.x + lastElement.width;\r\n        const totalWidth = endX - startX;\r\n        let totalElementsWidth = 0;\r\n        selected.forEach(el => totalElementsWidth += el.width);        const availableSpace = totalWidth - totalElementsWidth;\r\n        const spacing = availableSpace / (selected.length - 1);\r\n\r\n        let currentX = startX;\r\n        selected.forEach((el, index) => {\r\n          if (index === 0) {\r\n            updatesMap[el.id] = { x: currentX };\r\n          } else {\r\n            currentX += selected[index - 1].width + spacing;\r\n            updatesMap[el.id] = { x: currentX };\r\n          }\r\n        });\r\n      } else { // vertical\r\n        const startY = firstElement.y;\r\n        const endY = lastElement.y + lastElement.height;\r\n        const totalHeight = endY - startY;\r\n        let totalElementsHeight = 0;\r\n        selected.forEach(el => totalElementsHeight += el.height);\r\n\r\n        const availableSpace = totalHeight - totalElementsHeight;\r\n        const spacing = availableSpace / (selected.length - 1);\r\n\r\n        let currentY = startY;\r\n        selected.forEach((el, index) => {\r\n          if (index === 0) {\r\n            updatesMap[el.id] = { y: currentY };\r\n          } else {\r\n            currentY += selected[index - 1].height + spacing;\r\n            updatesMap[el.id] = { y: currentY };\r\n          }\r\n        });\r\n      }\r\n\r\n      // Применяем обновления\r\n      return prevElements.map(el => {\r\n        if (updatesMap[el.id]) {\r\n          return { ...el, ...updatesMap[el.id] };\r\n        }\r\n        return el;\r\n      });\r\n    });\r\n  }, [elements, selectedElementIds]);\r\n\r\n  const loadMySite = useCallback(async () => {\r\n    const token = localStorage.getItem('access_token');\r\n    if (!token) {\r\n      alert('Вы не авторизованы. Пожалуйста, войдите как администратор.');\r\n      return;\r\n    }\r\n    if (!window.confirm('Вы уверены, что хотите загрузить сайт с сервера? Все несохраненные изменения будут потеряны!')) {\r\n        return;\r\n    }\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/admin/load_my_site_data`, {\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`\r\n        }\r\n      });\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.msg || 'Ошибка при загрузке сайта с сервера');\r\n      }\r\n      let loadedElements = await response.json();\r\n      // Ensure loaded elements have parentId, customClasses, customStyles, and new flex properties\r\n      loadedElements = loadedElements.map(el => ({\r\n          ...el,\r\n          parentId: el.parentId === undefined ? null : el.parentId,\r\n          props: {\r\n              ...(el.props || {}),\r\n              customClasses: el.props && el.props.customClasses === undefined ? [] : el.props.customClasses,\r\n              customStyles: el.props && el.props.customStyles === undefined ? {} : el.props.customStyles,\r\n              displayMode: el.type === 'group' && el.props && el.props.displayMode === undefined ? 'absolute' : (el.props ? el.props.displayMode : undefined),\r\n              flexDirection: el.type === 'group' && el.props && el.props.flexDirection === undefined ? 'row' : (el.props ? el.props.flexDirection : undefined),\r\n              justifyContent: el.type === 'group' && el.props && el.props.justifyContent === undefined ? 'flex-start' : (el.props ? el.props.justifyContent : undefined),\r\n              alignItems: el.type === 'group' && el.props && el.props.alignItems === undefined ? 'stretch' : (el.props ? el.props.alignItems : undefined),\r\n              gap: el.type === 'group' && el.props && el.props.gap === undefined ? '0px' : (el.props ? el.props.gap : undefined),\r\n          }\r\n      }));\r\n      setElements(loadedElements);\r\n      setHistory([loadedElements]);\r\n      setHistoryIndex(0);\r\n      setSelectedElementIds([]);\r\n      alert('Сайт успешно загружен с сервера!');\r\n    } catch (error) {\r\n      console.error(\"Error loading site:\", error);\r\n      alert(`Ошибка загрузки сайта: ${error.message}`);\r\n    }\r\n  }, []);\r\n\r\n  const groupSelectedElements = useCallback(() => {\r\n      if (selectedElementIds.length < 2) return;\r\n      const elementsToGroup = elements.filter(el => selectedElementIds.includes(el.id) && el.type !== 'group');\r\n      if (elementsToGroup.length < 2) {\r\n          alert('Для группировки выберите хотя бы два негруппированных элемента.');\r\n          return;\r\n      }\r\n      const hasMixedParents = new Set(elementsToGroup.map(el => el.parentId)).size > 1;\r\n      const hasParentGroupSelected = elementsToGroup.some(el => el.parentId && selectedElementIds.includes(el.parentId));\r\n      if (hasMixedParents || hasParentGroupSelected) {\r\n          alert('Нельзя группировать элементы из разных групп или элементы вместе с их родительскими группами. Сначала разгруппируйте их.');\r\n          return;\r\n      }\r\n      let minX = Infinity, minY = Infinity;\r\n      let maxX = -Infinity, maxY = -Infinity;\r\n      elementsToGroup.forEach(el => {\r\n          const absPos = getAbsolutePosition(el);\r\n          minX = Math.min(minX, absPos.x);\r\n          minY = Math.min(minY, absPos.y);\r\n          maxX = Math.max(maxX, absPos.x + el.width);\r\n          maxY = Math.max(maxY, absPos.y + el.height);\r\n      });\r\n      const newGroupId = generateUniqueId();\r\n      const newGroup = {\r\n          id: newGroupId,\r\n          type: 'group',\r\n          x: minX,\r\n          y: minY,\r\n          width: maxX - minX,\r\n          height: maxY - minY,\r\n          parentId: null,\r\n          props: {\r\n            name: `Группа ${elements.filter(el => el.type === 'group').length + 1}`,\r\n            customClasses: [],\r\n            customStyles: {},\r\n            displayMode: 'absolute',\r\n            flexDirection: 'row',\r\n            justifyContent: 'flex-start',\r\n            alignItems: 'stretch',\r\n            gap: '0px',\r\n          }\r\n      };\r\n      setElements(prevElements => {\r\n          return [\r\n              ...prevElements.filter(el => !selectedElementIds.includes(el.id)),\r\n              newGroup,\r\n              ...elementsToGroup.map(el => {\r\n                  const absPos = getAbsolutePosition(el);\r\n                  return {\r\n                      ...el,\r\n                      parentId: newGroupId,\r\n                      x: absPos.x - newGroup.x,\r\n                      y: absPos.y - newGroup.y,\r\n                  };\r\n              })\r\n          ];\r\n      });\r\n      setSelectedElementIds([newGroupId]);\r\n  }, [elements, selectedElementIds, getAbsolutePosition]);\r\n\r\n  return (\r\n    <div>\r\n      <Header />\r\n      <div className=\"editor\">\r\n        <Sidebar addElement={addElement} />\r\n        <Canvas\r\n          ref={canvasRef}\r\n          elements={elements}\r\n          updateElement={updateElement}\r\n          updateMultipleElements={updateMultipleElements}\r\n          selectedElementIds={selectedElementIds}\r\n          setSelectedElementIds={setSelectedElementIds}\r\n          deleteElement={deleteElement}\r\n        />\r\n        <PropertiesPanel\r\n          selectedElement={selectedElement}\r\n          selectedElementIds={selectedElementIds}\r\n          updateElementProps={updateElementProps}\r\n          updateElement={updateElement}\r\n          saveCanvas={saveCanvas}\r\n          clearCanvas={clearCanvas}\r\n          exportToHtmlCss={exportToHtmlCss}\r\n          undo={undo}\r\n          redo={redo}\r\n          canUndo={canUndo}\r\n          canRedo={canRedo}\r\n          deleteSelectedElements={deleteSelectedElements}\r\n          alignElements={alignElements}\r\n          distributeElements={distributeElements}\r\n        />\r\n        <AIColorPaletteGenerator />\r\n        <LayersPanel\r\n          elements={elements}\r\n          selectedElementIds={selectedElementIds}\r\n          setSelectedElementIds={setSelectedElementIds}\r\n          updateElement={updateElement}\r\n          updateElementProps={updateElementProps}\r\n          onMoveLayer={onMoveLayer}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Editor; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
# Telegram Bot для ProThemesRU

## Описание

Telegram-бот для проекта ProThemesRU предоставляет удобный интерфейс для управления сайтами через мессенджер. Бот поддерживает команды для просмотра портфолио, запуска конструктора, экспорта сайтов и получения поддержки.

## Функции бота

- `/start` - Приветствие и знакомство с ботом
- `/help` - Список всех доступных команд
- `/editor` - Ссылка на онлайн-редактор сайтов
- `/my_site` - Просмотр опубликованного сайта
- `/export_zip` - Экспорт сайта в ZIP-архив (только для админа)
- `/faq` - Часто задаваемые вопросы
- `/support` - Контакты службы поддержки

## Установка и настройка

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Создание Telegram-бота

1. Найдите @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен

### 3. Настройка переменных окружения

Создайте файл `.env` на основе `env_example.txt`:

```bash
cp env_example.txt .env
```

Отредактируйте `.env` файл:

```env
# Обязательные настройки
TELEGRAM_BOT_TOKEN=ваш_токен_от_botfather
SECRET_KEY=ваш_секретный_ключ

# Настройки API
FLASK_API_BASE_URL=http://127.0.0.1:5000/api
FLASK_PUBLIC_SITE_URL=http://127.0.0.1:5000/public
FLASK_EDITOR_URL=http://localhost:3000

# Админские учетные данные
ADMIN_USERNAME=admin
ADMIN_PASSWORD=ваш_пароль_админа
```

### 4. Запуск Flask-приложения

```bash
python app.py
```

### 5. Запуск Telegram-бота

В отдельном терминале:

```bash
python run_telegram_bot.py
```

## API Endpoints

Бот использует следующие API endpoints:

- `POST /api/auth/login` - Аутентификация
- `GET /api/admin/load_my_site_data` - Загрузка данных сайта
- `POST /api/admin/save_my_site_data` - Сохранение данных сайта
- `POST /api/sites/export_site` - Экспорт сайта
- `POST /api/sites/publish_site` - Публикация сайта

## Структура проекта

```
app/
├── telegram_bot.py          # Основной файл бота
├── api/
│   └── routes.py           # API endpoints
├── models.py               # Модели данных
└── __init__.py            # Инициализация Flask

run_telegram_bot.py         # Скрипт запуска бота
requirements.txt           # Зависимости
env_example.txt           # Пример переменных окружения
```

## Безопасность

- Все API endpoints защищены JWT-токенами
- Админские функции доступны только авторизованным пользователям
- Токены имеют ограниченное время жизни (24 часа)
- Все секретные данные хранятся в переменных окружения

## Разработка

### Добавление новых команд

1. Создайте новую асинхронную функцию в `telegram_bot.py`
2. Добавьте обработчик в `init_telegram_bot()`
3. Обновите справку в `help_command()`

### Тестирование

```bash
# Запуск в режиме отладки
FLASK_DEBUG=1 python app.py

# Запуск бота с подробным логированием
python run_telegram_bot.py
```

## Устранение неполадок

### Бот не отвечает
- Проверьте правильность токена
- Убедитесь, что Flask-приложение запущено
- Проверьте логи на наличие ошибок

### Ошибки API
- Проверьте настройки URL в `.env`
- Убедитесь, что база данных создана
- Проверьте права доступа к файлам

### Проблемы с экспортом
- Убедитесь, что админские учетные данные корректны
- Проверьте наличие данных сайта в `site_data.json`

## Поддержка

При возникновении проблем:
1. Проверьте логи приложения
2. Убедитесь в корректности настроек
3. Обратитесь к документации API
4. Свяжитесь с поддержкой через `/support` в боте 
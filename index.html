<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProThemesRU - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å–∞–π—Ç–æ–≤</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="assets/style.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <nav class="nav">
                <div class="logo">
                    <div class="logo-icon">üöÄ</div>
                    <span>ProThemesRU</span>
                </div>
                <div class="nav-links">
                    <a href="#" class="nav-link active" onclick="showTab('templates')">
                        <i class="fas fa-palette"></i> –®–∞–±–ª–æ–Ω—ã
                    </a>
                    <a href="#" class="nav-link" onclick="showTab('constructor')">
                        <i class="fas fa-magic"></i> –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
                    </a>
                    <a href="#" class="nav-link" onclick="showTab('cart')">
                        <i class="fas fa-shopping-cart"></i> –ö–æ—Ä–∑–∏–Ω–∞
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                    <a href="#" class="nav-link" onclick="showTab('referral')">
                        <i class="fas fa-gift"></i> –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
                    </a>
                    <a href="#" class="nav-link" onclick="showTab('my-sites')">
                        <i class="fas fa-user"></i> –ú–æ–∏ —Å–∞–π—Ç—ã
                    </a>
                    <a href="#" class="nav-link" onclick="showTab('admin')" id="adminLink" style="display: none;">
                        <i class="fas fa-crown"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                    </a>
                    <a href="#" class="nav-link" onclick="showLogin()">
                        <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                    </a>
                </div>
            </nav>
        </header>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-number" id="templates-count">5</div>
                    <div class="status-label">–ü—Ä–µ–º–∏—É–º —à–∞–±–ª–æ–Ω–æ–≤</div>
                </div>
                <div class="status-item">
                    <div class="status-number" id="users-count">0</div>
                    <div class="status-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="status-item">
                    <div class="status-number" id="sites-count">0</div>
                    <div class="status-label">–°–æ–∑–¥–∞–Ω–æ —Å–∞–π—Ç–æ–≤</div>
                </div>
                <div class="status-item">
                    <div class="status-number" id="api-status">‚úÖ</div>
                    <div class="status-label">–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Templates Tab -->
            <div class="tab-content active" id="templates-tab">
                <div class="tab-header">
                    <h2><i class="fas fa-crown"></i> –ü—Ä–µ–º–∏—É–º —à–∞–±–ª–æ–Ω—ã</h2>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞</p>
                </div>
                <div class="template-grid" id="template-grid">
                    <!-- Templates will be loaded here -->
                </div>
            </div>

            <!-- Constructor Tab -->
            <div class="tab-content" id="constructor-tab">
                <div class="tab-header">
                    <h2><i class="fas fa-magic"></i> –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</h2>
                    <div class="constructor-actions">
                        <button class="btn btn-secondary" onclick="addElement()">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç
                        </button>
                        <button class="btn btn-primary" onclick="saveSite()">
                            <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                        <button class="btn btn-primary" onclick="publishSite()">
                            <i class="fas fa-globe"></i> –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>
                <div class="canvas" id="canvas">
                    <div class="canvas-empty">
                        <i class="fas fa-mouse-pointer"></i>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–º–∏—É–º —à–∞–±–ª–æ–Ω –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–∞–π—Ç —Å –Ω—É–ª—è</p>
                        <p style="font-size: 0.9em; margin-top: 10px; color: #FFA500;">
                            <i class="fas fa-star"></i> –¢–æ–ª—å–∫–æ –ª—É—á—à–∏–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞
                        </p>
                    </div>
                </div>
            </div>

            <!-- Cart Tab -->
            <div class="tab-content" id="cart-tab">
                <div class="tab-header">
                    <h2><i class="fas fa-shopping-cart"></i> –ö–æ—Ä–∑–∏–Ω–∞</h2>
                    <p>–í–∞—à–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –∏ —É—Å–ª—É–≥–∏</p>
                </div>
                <div class="cart-content">
                    <div class="cart-items" id="cartItems">
                        <!-- Cart items will be loaded here -->
                    </div>
                    <div class="cart-summary">
                        <div class="cart-calculator">
                            <h3><i class="fas fa-calculator"></i> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h3>
                            <div class="calculator-item">
                                <span>–®–∞–±–ª–æ–Ω—ã:</span>
                                <span id="templatesTotal">0 ‚ÇΩ</span>
                            </div>
                            <div class="calculator-item">
                                <span>–•–æ—Å—Ç–∏–Ω–≥ (–º–µ—Å—è—Ü):</span>
                                <span id="hostingTotal">500 ‚ÇΩ</span>
                            </div>
                            <div class="calculator-item">
                                <span>–î–æ–º–µ–Ω (–≥–æ–¥):</span>
                                <span id="domainTotal">1200 ‚ÇΩ</span>
                            </div>
                            <div class="calculator-item">
                                <span>SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:</span>
                                <span id="seoTotal">2000 ‚ÇΩ</span>
                            </div>
                            <div class="calculator-item total">
                                <span><strong>–ò—Ç–æ–≥–æ:</strong></span>
                                <span id="grandTotal"><strong>3700 ‚ÇΩ</strong></span>
                            </div>
                        </div>
                        <div class="cart-actions">
                            <button class="btn btn-primary" onclick="checkout()">
                                <i class="fas fa-credit-card"></i> –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                            </button>
                            <button class="btn btn-secondary" onclick="clearCart()">
                                <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Referral Tab -->
            <div class="tab-content" id="referral-tab">
                <div class="tab-header">
                    <h2><i class="fas fa-gift"></i> –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h2>
                    <p>–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ</p>
                </div>
                <div class="referral-content">
                    <div class="referral-card">
                        <h3><i class="fas fa-school"></i> –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —à–∫–æ–ª—É</h3>
                        <div class="referral-link">
                            <input type="text" id="referralLink" value="https://prothemesru.vercel.app/?ref=YOUR_CODE" readonly>
                            <button class="btn btn-primary" onclick="copyReferralLink()">
                                <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                        <div class="referral-stats">
                            <div class="stat-item">
                                <div class="stat-number" id="referralsCount">0</div>
                                <div class="stat-label">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="earningsTotal">0 ‚ÇΩ</div>
                                <div class="stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="referralCode">YOUR_CODE</div>
                                <div class="stat-label">–í–∞—à –∫–æ–¥</div>
                            </div>
                        </div>
                    </div>
                    <div class="referral-benefits">
                        <h3>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h3>
                        <ul>
                            <li><i class="fas fa-check"></i> –ü–æ–ª—É—á–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É</li>
                            <li><i class="fas fa-check"></i> –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å –¥—Ä—É–∑—å—è–º–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö</li>
                            <li><i class="fas fa-check"></i> –ü–æ–ª—É—á–∏—Ç–µ 10% –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –≤–∞—à–∏—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</li>
                            <li><i class="fas fa-check"></i> –ù–∞–∫–æ–ø–∏—Ç–µ –±–æ–Ω—É—Å—ã –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–µ–º–∏—É–º —à–∞–±–ª–æ–Ω—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- My Sites Tab -->
            <div class="tab-content" id="my-sites-tab">
                <div class="tab-header">
                    <h2><i class="fas fa-user"></i> –ú–æ–∏ —Å–∞–π—Ç—ã</h2>
                    <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏</p>
                </div>
                <div class="my-sites-content" id="mySitesContent">
                    <!-- User sites will be loaded here -->
                </div>
            </div>

            <!-- Admin Tab -->
            <div class="tab-content" id="admin-tab">
                <div class="tab-header">
                    <h2><i class="fas fa-crown"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</p>
                </div>
                <div class="admin-content">
                    <div class="admin-stats">
                        <div class="stat-card">
                            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            <div class="stat-grid">
                                <div class="stat-item">
                                    <div class="stat-number" id="adminUsersCount">0</div>
                                    <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number" id="adminSitesCount">0</div>
                                    <div class="stat-label">–°–∞–π—Ç–æ–≤</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number" id="adminTemplatesCount">0</div>
                                    <div class="stat-label">–®–∞–±–ª–æ–Ω–æ–≤</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number" id="adminPaymentsCount">0</div>
                                    <div class="stat-label">–ü–ª–∞—Ç–µ–∂–µ–π</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admin-actions">
                        <button class="btn btn-primary" onclick="loadAdminData()">
                            <i class="fas fa-refresh"></i> –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                        </button>
                        <button class="btn btn-secondary" onclick="exportData()">
                            <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–º–∏—É–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞...</p>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-sign-in-alt"></i> –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
                </h3>
                <button class="close" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" class="form-input" name="username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                </button>
                <p style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="showRegister()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user-plus"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                </h3>
                <button class="close" onclick="closeModal('registerModal')">&times;</button>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" class="form-input" name="username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" name="email" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-user-plus"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </button>
                <p style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="showLogin()">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</a>
                </p>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentSite = null;
        let templates = [];
        let cart = [];
        let elements = [];
        let currentTab = 'templates';

        // API Base URL
        const API_BASE = 'https://prothemesru.vercel.app/api';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkAPIHealth();
            loadTemplates();
            setupEventListeners();
            loadCart();
            generateReferralCode();
        });

        // API Health Check
        async function checkAPIHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                document.getElementById('templates-count').textContent = data.templates_count || 5;
                document.getElementById('users-count').textContent = data.users_count || 0;
                document.getElementById('sites-count').textContent = data.sites_count || 0;
                document.getElementById('api-status').textContent = '‚úÖ';
                
                console.log('API Health:', data);
            } catch (error) {
                document.getElementById('api-status').textContent = '‚ùå';
                console.error('API Health Error:', error);
            }
        }

        // Load Templates
        async function loadTemplates() {
            try {
                showLoading(true);
                const response = await fetch(`${API_BASE}/templates`);
                const data = await response.json();
                templates = data.templates;
                
                renderTemplates();
            } catch (error) {
                console.error('Error loading templates:', error);
                // Fallback templates
                templates = [
                    {
                        id: 1,
                        name: '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –±–∏–∑–Ω–µ—Å',
                        category: 'business',
                        price: 5000,
                        downloads: 150,
                        rating: 4.9,
                        description: '–≠–ª–∏—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –ø—Ä–µ–º–∏—É–º –±–∏–∑–Ω–µ—Å–∞'
                    },
                    {
                        id: 2,
                        name: '–ó–æ–ª–æ—Ç–æ–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ',
                        category: 'portfolio',
                        price: 3000,
                        downloads: 89,
                        rating: 4.8,
                        description: '–°—Ç–∏–ª—å–Ω–æ–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ —Å –∑–æ–ª–æ—Ç—ã–º –¥–∏–∑–∞–π–Ω–æ–º'
                    },
                    {
                        id: 3,
                        name: '–ü—Ä–µ–º–∏—É–º –º–∞–≥–∞–∑–∏–Ω',
                        category: 'ecommerce',
                        price: 8000,
                        downloads: 234,
                        rating: 4.7,
                        description: '–õ—é–∫—Å–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω'
                    },
                    {
                        id: 4,
                        name: 'VIP –±–ª–æ–≥',
                        category: 'blog',
                        price: 2000,
                        downloads: 67,
                        rating: 4.6,
                        description: '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –±–ª–æ–≥ –¥–ª—è —ç–ª–∏—Ç—ã'
                    },
                    {
                        id: 5,
                        name: '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ª–µ–Ω–¥–∏–Ω–≥',
                        category: 'landing',
                        price: 4000,
                        downloads: 312,
                        rating: 5.0,
                        description: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è'
                    }
                ];
                renderTemplates();
            } finally {
                showLoading(false);
            }
        }

        // Render Templates
        function renderTemplates() {
            const grid = document.getElementById('template-grid');
            grid.innerHTML = '';
            
            templates.forEach(template => {
                const card = document.createElement('div');
                card.className = 'template-card';
                
                card.innerHTML = `
                    <div class="template-header">
                        <div class="template-name">
                            <i class="fas fa-crown"></i> ${template.name}
                        </div>
                        <div class="template-price">${template.price} ‚ÇΩ</div>
                    </div>
                    <div class="template-category">${template.category}</div>
                    <div class="template-stats">
                        <span><i class="fas fa-star"></i> ${template.rating}</span>
                        <span><i class="fas fa-download"></i> ${template.downloads}</span>
                    </div>
                    <div class="template-description">
                        ${template.description}
                    </div>
                    <div class="template-actions">
                        <button class="btn btn-secondary" onclick="previewTemplate(${template.id})">
                            <i class="fas fa-eye"></i> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                        <button class="btn btn-primary" onclick="addToCart(${template.id})">
                            <i class="fas fa-cart-plus"></i> –í –∫–æ—Ä–∑–∏–Ω—É
                        </button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Show Tab
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked nav link
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            // Load tab-specific content
            if (tabName === 'my-sites') {
                loadMySites();
            } else if (tabName === 'admin') {
                loadAdminData();
            }
        }

        // Add to Cart
        function addToCart(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;
            
            const existingItem = cart.find(item => item.id === templateId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...template,
                    quantity: 1
                });
            }
            
            updateCart();
            alert(`üëë ${template.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!`);
        }

        // Update Cart
        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            
            cartCount.textContent = cart.reduce((total, item) => total + item.quantity, 0);
            
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="empty-cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
                updateCalculator();
                return;
            }
            
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">
                            <i class="fas fa-crown"></i> ${item.name}
                        </div>
                        <div class="cart-item-price">${item.price} ‚ÇΩ</div>
                    </div>
                    <div class="cart-item-actions">
                        <button class="btn btn-small" onclick="updateQuantity(${item.id}, -1)">-</button>
                        <span class="quantity">${item.quantity}</span>
                        <button class="btn btn-small" onclick="updateQuantity(${item.id}, 1)">+</button>
                        <button class="btn btn-small btn-danger" onclick="removeFromCart(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            updateCalculator();
        }

        // Update Quantity
        function updateQuantity(itemId, change) {
            const item = cart.find(item => item.id === itemId);
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                removeFromCart(itemId);
            } else {
                updateCart();
            }
        }

        // Remove from Cart
        function removeFromCart(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            updateCart();
        }

        // Update Calculator
        function updateCalculator() {
            const templatesTotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const hostingTotal = 500; // Monthly hosting
            const domainTotal = 1200; // Yearly domain
            const seoTotal = 2000; // SEO optimization
            
            const grandTotal = templatesTotal + hostingTotal + domainTotal + seoTotal;
            
            document.getElementById('templatesTotal').textContent = templatesTotal + ' ‚ÇΩ';
            document.getElementById('hostingTotal').textContent = hostingTotal + ' ‚ÇΩ';
            document.getElementById('domainTotal').textContent = domainTotal + ' ‚ÇΩ';
            document.getElementById('seoTotal').textContent = seoTotal + ' ‚ÇΩ';
            document.getElementById('grandTotal').innerHTML = '<strong>' + grandTotal + ' ‚ÇΩ</strong>';
        }

        // Load Cart
        function loadCart() {
            const savedCart = localStorage.getItem('prothemesru_cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCart();
            }
        }

        // Save Cart
        function saveCart() {
            localStorage.setItem('prothemesru_cart', JSON.stringify(cart));
        }

        // Clear Cart
        function clearCart() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')) {
                cart = [];
                updateCart();
                saveCart();
            }
        }

        // Checkout
        function checkout() {
            if (!currentUser) {
                showLogin();
                return;
            }
            
            if (cart.length === 0) {
                alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) + 3700; // + hosting, domain, seo
            
            alert(`üí≥ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –Ω–∞ —Å—É–º–º—É ${total} ‚ÇΩ\n\n–§—É–Ω–∫—Ü–∏—è –æ–ø–ª–∞—Ç—ã –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏!`);
        }

        // Generate Referral Code
        function generateReferralCode() {
            const code = 'REF' + Math.random().toString(36).substr(2, 6).toUpperCase();
            document.getElementById('referralCode').textContent = code;
            document.getElementById('referralLink').value = `https://prothemesru.vercel.app/?ref=${code}`;
        }

        // Copy Referral Link
        function copyReferralLink() {
            const link = document.getElementById('referralLink');
            link.select();
            document.execCommand('copy');
            alert('üîó –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
        }

        // Preview Template
        function previewTemplate(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;
            
            showTab('constructor');
            loadTemplateToCanvas(template);
        }

        // Load Template to Canvas
        function loadTemplateToCanvas(template) {
            const canvas = document.getElementById('canvas');
            canvas.className = 'canvas';
            canvas.innerHTML = '';
            
            // Create template elements
            const elements = createTemplateElements(template);
            elements.forEach(element => {
                canvas.appendChild(element);
            });
        }

        // Create Template Elements
        function createTemplateElements(template) {
            const elements = [];
            
            // Header
            const header = createElement('header', '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫', `
                <div style="text-align: center; padding: 40px 20px; background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; border-radius: 15px;">
                    <h1 style="font-size: 3em; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                        <i class="fas fa-crown"></i> ${template.name}
                    </h1>
                    <p style="font-size: 1.2em; margin: 20px 0; opacity: 0.8;">
                        ${template.description}
                    </p>
                    <div style="margin-top: 20px;">
                        <span style="background: rgba(0,0,0,0.2); padding: 10px 20px; border-radius: 20px; margin: 0 10px;">
                            <i class="fas fa-star"></i> ${template.rating}
                        </span>
                        <span style="background: rgba(0,0,0,0.2); padding: 10px 20px; border-radius: 20px; margin: 0 10px;">
                            <i class="fas fa-download"></i> ${template.downloads}
                        </span>
                    </div>
                </div>
            `);
            elements.push(header);
            
            // Content
            const content = createElement('section', '–ü—Ä–µ–º–∏—É–º –∫–æ–Ω—Ç–µ–Ω—Ç', `
                <div style="padding: 60px 40px; text-align: center; background: rgba(255,215,0,0.1); border-radius: 15px;">
                    <h2 style="color: #FFD700; font-size: 2.5em; margin-bottom: 20px;">
                        <i class="fas fa-gem"></i> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –ø—Ä–µ–º–∏—É–º–∞!
                    </h2>
                    <p style="font-size: 1.3em; color: #FFA500; margin-bottom: 30px;">
                        –≠—Ç–æ –≤–∞—à —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π —Å–∞–π—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞ "${template.name}".
                    </p>
                    <p style="font-size: 1.1em; color: #fff; margin-bottom: 40px;">
                        –ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–∏–ª—è –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞.
                    </p>
                    <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                        <div style="background: rgba(255,215,0,0.2); padding: 20px; border-radius: 10px; border: 1px solid #FFD700;">
                            <i class="fas fa-crown" style="font-size: 2em; color: #FFD700;"></i>
                            <p style="margin-top: 10px; color: #FFD700;">–ü—Ä–µ–º–∏—É–º –¥–∏–∑–∞–π–Ω</p>
                        </div>
                        <div style="background: rgba(255,215,0,0.2); padding: 20px; border-radius: 10px; border: 1px solid #FFD700;">
                            <i class="fas fa-rocket" style="font-size: 2em; color: #FFD700;"></i>
                            <p style="margin-top: 10px; color: #FFD700;">–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</p>
                        </div>
                        <div style="background: rgba(255,215,0,0.2); padding: 20px; border-radius: 10px; border: 1px solid #FFD700;">
                            <i class="fas fa-mobile-alt" style="font-size: 2em; color: #FFD700;"></i>
                            <p style="margin-top: 10px; color: #FFD700;">–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
                        </div>
                    </div>
                </div>
            `);
            elements.push(content);
            
            // Footer
            const footer = createElement('footer', '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–æ–¥–≤–∞–ª', `
                <div style="background: linear-gradient(135deg, #000, #333); padding: 40px 20px; text-align: center; margin-top: 40px; border-radius: 15px; border: 2px solid #FFD700;">
                    <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; margin-bottom: 20px;">
                        <div style="color: #FFD700;">
                            <i class="fas fa-crown" style="font-size: 2em;"></i>
                            <p style="margin-top: 10px; font-weight: bold;">ProThemesRU</p>
                        </div>
                        <div style="color: #FFA500;">
                            <i class="fas fa-star" style="font-size: 2em;"></i>
                            <p style="margin-top: 10px;">–ü—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ</p>
                        </div>
                        <div style="color: #FFD700;">
                            <i class="fas fa-gem" style="font-size: 2em;"></i>
                            <p style="margin-top: 10px;">–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω</p>
                        </div>
                    </div>
                    <p style="color: #FFA500; font-size: 1.1em;">
                        &copy; 2024 ProThemesRU. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. 
                        <i class="fas fa-crown"></i> –ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∫–∞—á–µ—Å—Ç–≤–∞.
                    </p>
                </div>
            `);
            elements.push(footer);
            
            return elements;
        }

        // Create Element
        function createElement(type, title, content) {
            const element = document.createElement('div');
            element.className = 'element';
            element.innerHTML = `
                <div class="element-header">
                    <div class="element-title">
                        <i class="fas fa-crown"></i> ${title}
                    </div>
                    <div class="element-actions">
                        <button class="element-action" onclick="editElement(this)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="element-action" onclick="deleteElement(this)" title="–£–¥–∞–ª–∏—Ç—å">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="element-content">
                    ${content}
                </div>
            `;
            return element;
        }

        // Add Element
        function addElement() {
            const canvas = document.getElementById('canvas');
            const element = createElement('div', '–ü—Ä–µ–º–∏—É–º —ç–ª–µ–º–µ–Ω—Ç', `
                <div style="background: linear-gradient(135deg, #FFD700, #FFA500); padding: 30px; border-radius: 15px; text-align: center; color: #000;">
                    <i class="fas fa-gem" style="font-size: 3em; margin-bottom: 20px;"></i>
                    <h3 style="margin-bottom: 15px;">–ù–æ–≤—ã–π –ø—Ä–µ–º–∏—É–º —ç–ª–µ–º–µ–Ω—Ç</h3>
                    <p>–≠—Ç–æ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å –∑–æ–ª–æ—Ç—ã–º –¥–∏–∑–∞–π–Ω–æ–º. –í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.</p>
                </div>
            `);
            canvas.appendChild(element);
        }

        // Edit Element
        function editElement(button) {
            const element = button.closest('.element');
            const content = element.querySelector('.element-content');
            const newContent = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:', content.innerHTML);
            
            if (newContent !== null) {
                content.innerHTML = newContent;
            }
        }

        // Delete Element
        function deleteElement(button) {
            const element = button.closest('.element');
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–º–∏—É–º —ç–ª–µ–º–µ–Ω—Ç?')) {
                element.remove();
            }
        }

        // Save Site
        async function saveSite() {
            if (!currentUser) {
                showLogin();
                return;
            }
            
            const siteName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—Ä–µ–º–∏—É–º —Å–∞–π—Ç–∞:');
            if (!siteName) return;
            
            try {
                showLoading(true);
                
                const canvas = document.getElementById('canvas');
                const elements = Array.from(canvas.querySelectorAll('.element')).map(el => ({
                    type: el.querySelector('.element-title').textContent,
                    content: el.querySelector('.element-content').innerHTML
                }));
                
                const response = await fetch(`${API_BASE}/sites`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentUser.token}`
                    },
                    body: JSON.stringify({
                        name: siteName,
                        elements: JSON.stringify(elements)
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert('üéâ –í–∞—à –ø—Ä–µ–º–∏—É–º —Å–∞–π—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                    currentSite = data.site;
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + data.error);
                }
            } catch (error) {
                console.error('Error saving site:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–∞–π—Ç–∞');
            } finally {
                showLoading(false);
            }
        }

        // Publish Site
        function publishSite() {
            if (!currentSite) {
                alert('üí° –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤–∞—à –ø—Ä–µ–º–∏—É–º —Å–∞–π—Ç');
                return;
            }
            
            alert('üöÄ –§—É–Ω–∫—Ü–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏!');
        }

        // Load My Sites
        async function loadMySites() {
            if (!currentUser) {
                document.getElementById('mySitesContent').innerHTML = '<p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∞—à–∏—Ö —Å–∞–π—Ç–æ–≤</p>';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/sites`, {
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const sites = data.sites;
                    const content = document.getElementById('mySitesContent');
                    
                    if (sites.length === 0) {
                        content.innerHTML = '<p class="empty-sites">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–µ–º–∏—É–º —Å–∞–π—Ç–æ–≤</p>';
                    } else {
                        content.innerHTML = sites.map(site => `
                            <div class="site-card">
                                <div class="site-info">
                                    <div class="site-name">
                                        <i class="fas fa-crown"></i> ${site.name}
                                    </div>
                                    <div class="site-date">${new Date(site.created_at).toLocaleDateString()}</div>
                                </div>
                                <div class="site-actions">
                                    <button class="btn btn-secondary" onclick="editSite(${site.id})">
                                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                    <button class="btn btn-primary" onclick="publishSite(${site.id})">
                                        <i class="fas fa-globe"></i> –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                                    </button>
                                </div>
                            </div>
                        `).join('');
                    }
                } else {
                    document.getElementById('mySitesContent').innerHTML = '<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∞–π—Ç–æ–≤</p>';
                }
            } catch (error) {
                console.error('Error loading sites:', error);
                document.getElementById('mySitesContent').innerHTML = '<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∞–π—Ç–æ–≤</p>';
            }
        }

        // Load Admin Data
        async function loadAdminData() {
            if (!currentUser || currentUser.role !== 'admin') {
                document.querySelector('.admin-content').innerHTML = '<p>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.</p>';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/admin/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const dashboard = data.dashboard;
                    document.getElementById('adminUsersCount').textContent = dashboard.total_users;
                    document.getElementById('adminSitesCount').textContent = dashboard.total_sites;
                    document.getElementById('adminTemplatesCount').textContent = dashboard.total_templates;
                    document.getElementById('adminPaymentsCount').textContent = dashboard.pro_users;
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏');
                }
            } catch (error) {
                console.error('Error loading admin data:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏');
            }
        }

        // Export Data
        function exportData() {
            if (!currentUser || currentUser.role !== 'admin') {
                alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω');
                return;
            }
            
            alert('üìä –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏!');
        }

        // Show Login
        function showLogin() {
            document.getElementById('loginModal').style.display = 'block';
        }

        // Show Register
        function showRegister() {
            document.getElementById('registerModal').style.display = 'block';
        }

        // Close Modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Show Loading
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Login Form
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const data = {
                    username: formData.get('username'),
                    password: formData.get('password')
                };
                
                try {
                    const response = await fetch(`${API_BASE}/auth/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        currentUser = {
                            ...result.user,
                            token: result.access_token
                        };
                        closeModal('loginModal');
                        alert('üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –ø—Ä–µ–º–∏—É–º–∞!');
                        
                        // Show admin link if user is admin
                        if (currentUser.role === 'admin') {
                            document.getElementById('adminLink').style.display = 'inline-block';
                        }
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + result.error);
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ');
                }
            });

            // Register Form
            document.getElementById('registerForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const data = {
                    username: formData.get('username'),
                    email: formData.get('email'),
                    password: formData.get('password')
                };
                
                try {
                    const response = await fetch(`${API_BASE}/auth/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        currentUser = {
                            ...result.user,
                            token: result.access_token
                        };
                        closeModal('registerModal');
                        alert('üëë –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —ç–ª–∏—Ç—É!');
                        
                        // Show admin link if user is admin
                        if (currentUser.role === 'admin') {
                            document.getElementById('adminLink').style.display = 'inline-block';
                        }
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + result.error);
                    }
                } catch (error) {
                    console.error('Register error:', error);
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                }
            });

            // Close modals on outside click
            window.onclick = function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            }
        }
    </script>
</body>
</html> 